plugins {
    id 'com.github.johnrengelman.shadow' version '1.2.2'
    id 'idea'
}

subprojects {
    apply plugin: 'scala'

    repositories {
        mavenLocal()
        mavenCentral()
//        maven { url "https://oss.sonatype.org/content/repositories/snapshots" }
        flatDir(dirs: 'models') // Yes you need both. Don't ask why.
        flatDir(dirs: 'ai/models')
    }

    compileScala {
        scalaCompileOptions.useCompileDaemon = true
    }

    tasks.withType(ScalaCompile) {
        scalaCompileOptions.useAnt = false
        sourceCompatibility = "1.7"
        targetCompatibility = "1.7"
    }

    configurations {
        all {
            exclude group: 'org.mortbay.jetty'
            exclude group: 'org.slf4j', module: 'slf4j-log4j12'
            exclude group: 'log4j', module: 'log4j'
            exclude group: 'org.fusesource.scalate'
            exclude group: 'com.sun.jersey.jersey-test-framework', module: 'jersey-test-framework-grizzly2'
            exclude group: 'com.sun.jersey', module: 'jersey-json'
            exclude group: 'com.sun.jersey', module: 'jersey-core'
        }
    }

    dependencies {
        testCompile group: 'junit', name: 'junit', version: '4.11'
        testCompile 'org.scalatest:scalatest_2.10:3.0.0-M7'
        compile "org.scala-lang:scala-library:2.10.5"
        compile "org.scala-lang:scala-compiler:2.10.5"
        compile "org.scala-lang:scala-reflect:2.10.5"

        // Spark
        compile('org.apache.spark:spark-core_2.10:1.5.2') {
            exclude group: 'com.google.guava'
            // yields security error due to differing versions
            exclude group: 'org.eclipse.jetty.orbit', module: 'javax.servlet'
            exclude group: 'org.glassfish', module: 'javax.servlet'
            exclude group: 'javax.servlet', module: 'javax.servlet-api'
            exclude group: 'com.sun.jersey.jersey-test-framework', module: 'jersey-test-framework-grizzly2'
            exclude group: 'com.sun.jersey', module: 'jersey-json'
            exclude group: 'com.sun.jersey', module: 'jersey-core'
        }
        compile 'org.apache.spark:spark-mllib_2.10:1.5.2'
        compile 'com.github.fommil.netlib:all:1.1.2'

        // DL4J
//        compile 'org.deeplearning4j:deeplearning4j-nlp:0.4-rc3.8'
//        compile 'org.deeplearning4j:deeplearning4j-ui:0.4-rc3.8'
//        compile 'org.deeplearning4j:dl4j-spark:0.4-rc3.8'
//        compile 'org.nd4j:nd4j-x86:0.4-rc3.8'

        compile 'org.deeplearning4j:deeplearning4j-nlp:0.4-rc3.9-SNAPSHOT'
        compile 'org.deeplearning4j:deeplearning4j-ui:0.4-rc3.9-SNAPSHOT'
        compile 'org.deeplearning4j:dl4j-spark:0.4-rc3.9-SNAPSHOT'
        compile 'org.nd4j:nd4j-native:0.4-rc3.9-SNAPSHOT'
        compile 'javax.ws.rs:javax.ws.rs-api:2.0.1'

        // These are required for json4s to work. Something imported a deprecated version.
        compile 'com.fasterxml.jackson.core:jackson-core:2.6.3'
        compile 'com.fasterxml.jackson.core:jackson-databind:2.6.3'
        compile 'com.fasterxml.jackson.core:jackson-annotations:2.6.3'
        compile 'com.fasterxml.jackson.module:jackson-module-scala_2.10:2.6.3'

        // The main Json library
        compile 'org.json4s:json4s-native_2.10:3.3.0'
        compile 'org.json4s:json4s-jackson_2.10:3.3.0'
        compile files('libs/alpn-boot-8.1.6.v20151105.jar')
    }
}
